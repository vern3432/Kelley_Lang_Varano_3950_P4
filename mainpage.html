
<!--I relaly want to add a top by with a title and maybe like a settings at the top rihgt. Dark Mode? wWould just make pages look complete  -->
<!-- Search bar? That could be a cool thing. Could use very basic horspool search of all post titles. Perhaps master index of posts should include id and title.   -->
<!-- Tab on Search Bar that Lets You Search for Users?? -->
<!-- Notes for server side: There is a link format for retrieving youtbe thumnails. We could either download this servise or just link them. Later is probably easier, will require a lot of requests but im guesing it wont be a problem unless -->
<!--  Format is as follow: 
https://www.youtube.com/watch?v=AD5aAd8Oy84-------_>https://img.youtube.com/vi/AD5aAd8Oy84/mqdefault.jpg
note identifier shared between links
this is only for Medium Quality (320x180). Should be all we need for thumnails. 
Im thinking these links should be stored in whatever json we generate to contain posts. on that note, need to determine how data will be stored in jsons and where in relation to poster and time. 
-->
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Youtube-Repost</title>
    <link rel="stylesheet" href="./styleA.css">
    
</head>
<div class="top-banner">
  <!-- <img class="banner_logo" src="templogo.png" alt=""> -->
  <form action=""></form>   <input type="text" id="fname" name="fname"><button class="searchbutton" onclick="search()">Search</button >
 <select name="searchtab" id="searchtype">
    <option value="Book_Title">Title</option>
    <option value="Book_Author">Author</option>
    <option value="Year_Of_Publication">Year</option>

  </select> -

</div>
<div id="sidebarcontainer">
  <div id="full_SideBar" class="sidebar">
    <script src="sidebar.js"></script>

    <a href="feed.html">
      <img id="home" class="icon" src="homepage.png" alt="" />
      <b class="sidebar_text" id="home" style="font-size: 23px">Home</b>
      <br />
    </a>

    <a href="./makepost.html">
      <img id="Post" class="icon" src="post3.png" alt="" />
      <b class="sidebar_text" id="Post" style="font-size: 23px">Post</b>
      <br />
    </a>
    <a href="./friendspage.html">
      <img id="friend" class="icon" src="friends2.png" alt="" />
      <b class="sidebar_text" id="friend" style="font-size: 23px">Friends</b>
      <br />
    </a>
    <a onclick="loadcurrUserPage()">
      <img id="profile" class="icon" src="profile2.png" alt="" />
      <b class="sidebar_text" id="friend" style="font-size: 23px">Profile</b>
      <br />
    </a>
    
   <a href="google.com">

    <img id="closenav"    class="icon" src="" alt=""> <b class="sidebar_text"  id="Post" style="  font-size: 23px;" ></b> <br>

   </a>
   <div id="main">
    <button id="sidebar_close"  class="open_button"   onclick="closeNav()"><img src="sidebarclose2.png" alt="" id="sidebarclose"> </button>  
    <br>
    <button id="sidebar_open" class="open_button" onclick="openNav()"><img src="sidebarclose2.png" alt="" id="sidebarclose" style="  transform: scaleX(-1);"> </button>  

  </div>
    
    
  </div>



  <div id="main">
    <!-- <button class="open_button" onclick="openNav()"><img src="sidebarclose2.png" alt="" id="sidebarclose"> </button>   -->
  
  </div>
</div>
<script>
  console.log(parseInt(localStorage.getItem('counter')))
// function tabcount(m){
//   n=m/20
//   for(let i=0;i<=n;i)
//   var div = document.getElementById("bottom_tabs").createElement('button');
//   div.innerHTML = str;
//   while (div.children.length > 0) {
//     el.appendChild(div.children[0]);
//   }
// }
// var html = '<h1 id="title">Some Title</h1><span style="display:inline-block; width=100px;">Some arbitrary text</span>';
// appendHtml(document.body, html);

// lets just do a next and last, seems easier. 
function tabcount_by20(start,total){
}


function search(){searchtype
  const search_term= document.getElementById('fname').value;
  const type=document.getElementById('searchtype').value;
      fetch('http://localhost:3001/search', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ 
  
          search_term:search_term,
          type:type,
        }),
      })
      .then(response => response.json())
                .then(data => {
                    var dataBody = document.getElementById('books_container');
                    dataBody.innerHTML='<p1>Search Results for:'+search_term+'</p1><br><button onclick="prev()" class="previous">&laquo; Previous</button><button onclick="next()" class="next">Next &raquo;</button>'
                    var buttoncounter=1;
                    data.forEach(row => {
                      // console.log(row.ISBN)
                        var rowHTML = '<div id="books">';
                        rowHTML +="<div id='book'>"
                        rowHTML += '<img src="' + row.Image_URL_L+'">' ;
                        rowHTML += '<br>' + row.ISBN ;
                        rowHTML += '<br>' + row.Book_Title ;
                        rowHTML += '<br>' + row.Book_Author ;
                        rowHTML += '<br>' + row.Year_Of_Publication+'<br>';
                        //remeber to add function that calls collection list so that we can precheck this box. I think that it should probably just laod a users collection on login. 
                        //Then provide a remove from colleciton option 
                        if(localStorage.getItem('collection_log').includes(row.ISBN)){
                          rowHTML += '<button style="background-color: crimson;color: white;border-radius: 10px;" id="button'+buttoncounter+' onclick="addCollection('+buttoncounter+','+row.ISBN+')">'+'Remove From Collection-'+'</button>';
                          console.log(' inclued')


                        }else{
                          console.log('not inclued')
                          rowHTML += '<button id="button'+buttoncounter+'" style="border-radius:10px;" '+' onclick="addCollection('+buttoncounter+','+row.ISBN+')">'+'Add to Collection +'+'</button>';
                          
                        }                        buttoncounter=+1
                        //rowHTML += '<br>' + row.Image_URL_S ;
                        //rowHTML += '<br>' + row.Image_URL_M;
                        //rowHTML += '<br>' + row.Image_URL_L ;
                        //rowHTML += '<br>';
                        rowHTML +="</div>"

                        dataBody.innerHTML += rowHTML;
                    });
                })
                .catch(error => console.log('Error fetching data: ', error));
    }

function submitTab(num_start) {
    console.log( 'collection log:'+localStorage.getItem('collection_log'))
      //username: "exampleUser",
      ///password: "examplePassword"
      // Make a POST request to the server
      fetch('http://localhost:3001/tab_page_request', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ start:parseInt(num_start), finish:(parseInt(num_start)+20) }),
      })
      .then(response => response.json())
                .then(data => {
                    var dataBody = document.getElementById('books_container');
                    dataBody.innerHTML='<button onclick="prev()" class="previous">&laquo; Previous</button><button onclick="next()" class="next">Next &raquo;</button>'
                    var buttoncounter=1;
                    data.forEach(row => {
                      // console.log(row.ISBN)
                        var rowHTML = '<div id="books">';
                        rowHTML +="<div id='book'>"
                        rowHTML += '<img src="' + row.Image_URL_L+'">' ;
                        rowHTML += '<br>' + row.ISBN ;
                        rowHTML += '<br>' + row.Book_Title ;
                        rowHTML += '<br>' + row.Book_Author ;
                        rowHTML += '<br>' + row.Year_Of_Publication ;
                        //remeber to add function that calls collection list so that we can precheck this box. I think that it should probably just laod a users collection on login. 
                        //Then provide a remove from colleciton option 
                        if(localStorage.getItem('collection_log').includes(row.ISBN)){
                          rowHTML += '<button id="button'+buttoncounter+'" style="background-color: crimson;color: white;border-radius: 10px;" '+' onclick="removeCollection('+buttoncounter+','+row.ISBN+')">'+'Remove From Collection-'+'</button>';
                          console.log(' inclued')
                          console.log(row.ISBN)


                        }else{
                          console.log('not inclued')
                          rowHTML += '<button id="button'+buttoncounter+'" style="border-radius:10px;" '+' onclick="addCollection('+buttoncounter+','+row.ISBN+')">'+'Add to Collection +'+'</button>';
                          
                        }
                        buttoncounter=buttoncounter+1
                        //rowHTML += '<br>' + row.Image_URL_S ;
                        //rowHTML += '<br>' + row.Image_URL_M;
                        //rowHTML += '<br>' + row.Image_URL_L ;
                        //rowHTML += '<br>';
                        rowHTML +="</div>"
                        dataBody.innerHTML += rowHTML;
                    });
                })
                .catch(error => console.log('Error fetching data: ', error));
    }
    console.log(localStorage.getItem("counter"))
    submitTab(localStorage.getItem("counter"))

    function next(){
      if(parseInt(localStorage.getItem('counter'))+20>100000000){
        console.log("max reached")
        console.log(localStorage.getItem('counter'))

      }
    else{
      localStorage.setItem("counter",parseInt(localStorage.getItem('counter'))+20)
      console.log(localStorage.getItem('counter'))
      submitTab(parseInt(localStorage.getItem('counter')))
    }
  }
  function prev(){
    if((parseInt(localStorage.getItem('counter'))-20)<0){
      console.log("min reached")
      console.log(localStorage.getItem('counter'))

      }
    else{
      localStorage.setItem("counter",parseInt(localStorage.getItem('counter'))-20)
      console.log(localStorage.getItem('counter'))
      submitTab(localStorage.getItem('counter'))

    }



  }
  if(localStorage.getItem('counter')){


  }else{
    localStorage.setItem("counter",1)

  }

  if(localStorage.getItem('curr_user')){


}else{
  //later make this return to login, will do this for testing purposes
  localStorage.setItem("curr_user",'aidan')

}

if(localStorage.getItem('collection_log')){

  // localStorage.setItem("collection_log",['2005018','887841740','080652121X','452264464','486284735'])

}else{
  //later make this return to login, will do this for testing purposes
  calStorage.setItem("collection_log",['451406923','743439740','2005018','887841740','080652121X','452264464','486284735'])
}



    // localStorage.getItem("counter",null)
function addCollection(buttoncounter,ISBN){
      user_forsend=localStorage.getItem('curr_user')
      fetch('http://localhost:3001/addCollection', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ 
          user_name:user_forsend, 
          ISBN:ISBN, 

        }),
      })
      .then(response => response.json())
      .then(data => {
        alert(data.message || data.error);
      })
      .catch(error => {
        console.error('Error:', error);
        alert('A Local error occurred. Please try again.');
      });
      console.log("button"+buttoncounter)
      HTMLOBJCET=document.getElementById("button"+buttoncounter)
      HTMLOBJCET.style='background-color: crimson;color: white;border-radius: 10px;'
      HTMLOBJCET.innerHTML='Remove From Collection-'
      HTMLOBJCET.oncick="removeCollection("+buttoncounter+","+ISBN+")"
      // = '<button id="button'+buttoncounter+'" style="background-color: crimson;color: white;border-radius: 10px;" '+' onclick="addCollection('+buttoncounter+','+ISBN+')">'+'Remove From Collection-'+'</button>';

    
    }
    ///need to update localling stored collection value
    
function removeCollection(buttoncounter,ISBN){
  user_forsend=localStorage.getItem('curr_user')
      fetch('http://localhost:3001/removeCollection', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ 
          user_name:user_forsend, 
          ISBN:ISBN, 

        }),
      })
      .then(response => response.json())
      .then(data => {
        alert(data.message || data.error);
      })
      .catch(error => {
        console.error('Error:', error);
        alert('A Local error occurred. Please try again.');
      });
      console.log("button"+buttoncounter)
      HTMLOBJCET=document.getElementById("button"+buttoncounter)
      HTMLOBJCET.style='background-color: crimson;color: white;border-radius: 10px;'
      HTMLOBJCET.innerHTML='Remove From Collection-'
      HTMLOBJCET.oncick="removeCollection("+buttoncounter+","+ISBN+")"
      // = '<button id="button'+buttoncounter+'" style="background-color: crimson;color: white;border-radius: 10px;" '+' onclick="addCollection('+buttoncounter+','+ISBN+')">'+'Remove From Collection-'+'</button>';

    
    }
</script>

<!-- <button onclick="addCollection('testvalue')">TESTTTTTTTTTT</button> -->
<style>
  a {
    text-decoration: none;
    display: inline-block;
    padding: 8px 16px;
  }
  
  a:hover {
    background-color: #0B504F;
    color: white;
  }
  
  .previous {
    background-color: #f1f1f1;
    color: black;
  }
  
  .next {
    background-color: #f1f1f1;
    color: black;
  }
  
  .round {
    border-radius: 50%;
  }
  </style>
<body id="pagecontent">
  <div id="books_container">

    <!-- <button type="button">Click Me!</button> -->


<!--     
    <a href="#" class="previous round">&#8249;</a>
    <a href="#" class="next round">&#8250;</a>
       -->
      </div>
    </body>
    <!-- submitTab(localStorage.getItem('counter')) -->


    </html> 
    











  </div>
</body>

</html>

